#! /nfs/filb2/public/bin/perl
#! /import/bin/perl

($progname) = ($0 =~ m!([^/]+)$!);
$usage = "usage: $progname [-b] [-o outfile] -s node1 [-d node2] [trace files...]\n";

sub writeln { print @_, "\n"; }

$opt_b = 0;
require 'getopts.pl';
&Getopts('bo:s:d:') || die $usage;
die $usage unless ($opt_s);

open(STDOUT, ">$opt_o") if ($opt_o);
while (<>) {
    /^v/ && do {
	print $_;
	next;
    };
    @F = split;
    if ($F[2] == $opt_s) {
	print $_ unless ($opt_d && $F[3] != $opt_d);
	next;
    }
    if ($opt_b && $F[3] == $opt_s) {
	print $_ unless ($opt_d && $F[2] != $opt_d);
	next;
    }
}
close(STDOUT);
exit;
