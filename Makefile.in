#  Copyright (c) 1994, 1995, 1996
# 	The Regents of the University of California.  All rights reserved.
#
#  Redistribution and use in source and binary forms, with or without
#  modification, are permitted provided that: (1) source code distributions
#  retain the above copyright notice and this paragraph in its entirety, (2)
#  distributions including binary code include the above copyright notice and
#  this paragraph in its entirety in the documentation or other materials
#  provided with the distribution, and (3) all advertising materials mentioning
#  features or use of this software display the following acknowledgement:
#  ``This product includes software developed by the University of California,
#  Lawrence Berkeley Laboratory and its contributors.'' Neither the name of
#  the University nor the names of its contributors may be used to endorse
#  or promote products derived from this software without specific prior
#  written permission.
#  THIS SOFTWARE IS PROVIDED ``AS IS'' AND WITHOUT ANY EXPRESS OR IMPLIED
#  WARRANTIES, INCLUDING, WITHOUT LIMITATION, THE IMPLIED WARRANTIES OF
#  MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE.
#
# @(#) $Header: /home/smtatapudi/Thesis/nsnam/nsnam/ns-2/Makefile.in,v 1.56 1997/08/05 01:12:12 polly Exp $ (LBL)

#
# Various configurable paths (remember to edit Makefile.in, not Makefile)
#

# Top level hierarchy
prefix = @prefix@
exec_prefix = @exec_prefix@
# Pathname of directory to install the binary
BINDEST = @bindir@
# Pathname of directory to install the man page
MANDEST = @mandir@

CC = @CC@
C++ = @CXX@
CCOPT = @V_CCOPT@
TCL2C++ = @V_TCL2CPP@

MKDEP = ./mkdep
LIB =  \
	@V_LIB_X11@ \
	@V_LIB@ \
	@V_LIBS@ \
	-lm @LIBS@

INCLUDE = \
	@V_INCLUDE_BTCL@ \
	@V_INCLUDE_X11@ \
	@V_INCLUDES@ \
	-I.

DEFINE = @V_DEFINE@ @V_DEFINES@ -DNO_TK -Dabort=_ABORT
STATIC = @V_STATIC@

CFLAGS =  $(INCLUDE) $(DEFINE) $(CCOPT)

INSTALL = @INSTALL@
RANLIB = @V_RANLIB@
@V_SHELL@

# Explicitly define compilation rules since SunOS 4's make doesn't like gcc.
# Also, gcc does not remove the .o before forking 'as', which can be a
# problem if you don't own the file but can write to the directory.
.SUFFIXES: .cc $(.SUFFIXES)

.cc.o:
	@rm -f $@
	$(C++) -o $@ -c $(CFLAGS) $*.cc

.c.o:
	@rm -f $@
	$(CC) -o $@ -c $(CFLAGS) $*.c

OBJ_CC = \
	random.o ranvar.o misc.o timer-handler.o \
	scheduler.o object.o \
	classifier.o classifier-addr.o classifier-flow.o classifier-hash.o \
	classifier-mcast.o classifier-mpath.o replicator.o \
	classifier-mac.o \
	packet.o ip.o route.o connector.o ttl.o \
	trace.o	trace-ip.o tracegen.o \
	cbr.o traffictrace.o pareto.o expoo.o telnet.o tcplib-telnet.o \
	agent.o message.o udp.o session-rtp.o rtp.o rtcp.o ivs.o \
	tcp.o tcp-sink.o tcp-reno.o tcp-newreno.o \
	tcp-vegas.o tcp-rbp.o tcp-full.o \
	scoreboard.o tcp-sack1.o tcp-fack.o \
	tcp-asym.o tcp-asym-sink.o \
	integrator.o queue-monitor.o flowmon.o loss-monitor.o \
	queue.o drop-tail.o red.o \
	semantic-packetqueue.o \
	sfq.o fq.o drr.o cbq.o \
	hackloss.o errmodel.o \
	delay.o ll.o snoop.o \
	channel.o mac.o mac-csma.o mac-802_11.o mac-multihop.o \
	dynalink.o rtProtoDV.o net-interface.o \
	ctrMcast.o prune.o srm.o \
	net.o net-ip.o tap.o \
	lib/int.Vec.o lib/int.RVec.o lib/dmalloc_support.o \
	sessionhelper.o

OBJ_C = \
	inet.o

OBJ_NAM = \
	nam/animation.o \
	nam/nam-drop.o \
	nam/nam-edge.o \
	nam/nam-node.o \
	nam/nam-packet.o \
	nam/nam-queue.o \
	nam/nam-trace.o \
	nam/paint.o \
	nam/state.o \
	nam/transform.o \
	nam/netview.o \
	nam/netmodel.o

OBJ_GEN = gen/version.o gen/ns_tcl.o

SRC =	$(OBJ_C:.o=.c) $(OBJ_CC:.o=.cc) $(OBJ_NAM:.o=.cc) \
	tclAppInit.cc tkAppInit.cc

OBJ =	$(OBJ_C) $(OBJ_CC) $(OBJ_GEN)
HDR =   agent.h config.h data-source.h integrator.h link.h node.h \
	object.h packet.h random.h scheduler.h scoreboard.h tcp.h trace.h \
	tcp-sink.h tcp-fack.h drop-tail.h red.h \
	queue-monitor.h semantic-packetqueue.h \
	cbr.h rtp.h cbr.h classifier.h connector.h ip.h \
	delay.h \
	snoop.h ll.h mac.h mac-multihop.h mac-csma.h mac-802_11.h \
	rtProtoDV.h ctrMcast.h prune.h ranvar.h

CLEANFILES = ns nsx ns.dyn $(OBJ) $(OBJ_NAM) tclAppInit.o \
	gen/* core core.ns core.nsx

ns: $(OBJ) tclAppInit.o
	$(C++) $(STATIC) -o $@ $(CFLAGS) $(OBJ) tclAppInit.o $(LIB)

nsx: $(OBJ) tkAppInit.o $(OBJ_NAM)
	$(C++) $(STATIC) -o $@ $(CFLAGS) $(OBJ) $(OBJ_NAM) tkAppInit.o $(LIB)

ns.dyn: $(OBJ) tclAppInit.o
	$(C++) -o $@ $(CFLAGS) $(OBJ) tclAppInit.o $(LIB)

gen/version.c: VERSION
	@rm -f $@
	cat VERSION | sed 's/.*/char version_string[] = "&";/' > $@

PURIFY	= purify -cache-dir=/tmp

ns.pure: $(OBJ) tclAppInit.o
	$(PURIFY) g++ $(STATIC) -o $@ $(CFLAGS) $(OBJ) tclAppInit.o $(LIB)

NS_TCL_LIB = \
	tcl/lib/ns-compat.tcl \
	tcl/lib/ns-default.tcl \
	tcl/lib/ns-lib.tcl \
	tcl/lib/ns-link.tcl \
	tcl/lib/ns-node.tcl \
	tcl/lib/ns-packet.tcl \
	tcl/lib/ns-queue.tcl \
	tcl/lib/ns-source.tcl \
	tcl/lib/ns-nam.tcl \
	tcl/lib/ns-trace.tcl \
	tcl/lib/ns-agent.tcl \
	tcl/lib/ns-random.tcl \
	tcl/rtp/session-rtp.tcl \
	tcl/rtglib/dynamics.tcl \
	tcl/rtglib/route-proto.tcl \
        tcl/interface/ns-iface.tcl \
        tcl/mcast/ns-mcast.tcl \
        tcl/mcast/McastProto.tcl \
        tcl/mcast/DM.tcl \
        tcl/mcast/dynamicDM.tcl \
        tcl/mcast/pimDM.tcl \
	tcl/mcast/srm.tcl \
	tcl/mcast/srm-adaptive.tcl \
        tcl/ctr-mcast/CtrMcast.tcl \
        tcl/ctr-mcast/CtrMcastComp.tcl \
        tcl/ctr-mcast/CtrRPComp.tcl \
        tcl/pim/pim-init.tcl \
        tcl/pim/pim-messagers.tcl \
        tcl/pim/pim-mfc.tcl \
        tcl/pim/pim-mrt.tcl \
        tcl/pim/pim-recvr.tcl \
        tcl/pim/pim-sender.tcl \
        tcl/pim/pim-vifs.tcl \
	tcl/session/session.tcl

gen/ns_tcl.cc: $(NS_TCL_LIB)
	@rm -f $@
	( cd tcl/lib; tclsh ../../tcl-expand.tcl ns-lib.tcl ) \
		| $(TCL2C++) et_ns_lib >> $@

install: force
	$(INSTALL) -m 555 -o bin -g bin ns $(DESTDIR)$(BINDEST)

install-man: force
	$(INSTALL) -m 444 -o bin -g bin ns.1 $(DESTDIR)$(MANDEST)/man1

clean:
	rm -f $(CLEANFILES)

distclean:
	rm -f $(CLEANFILES) Makefile config.cache config.log config.status \
	    gnuc.h os-proto.h

tags:	force
	ctags -wtd *.cc *.h ../Tcl/*.cc ../Tcl/*.h

TAGS:	force
	etags *.cc *.h ../Tcl/*.cc ../Tcl/*.h

depend: $(SRC)
	$(MKDEP) $(CFLAGS) $(SRC)

srctar:
	@cwd=`pwd` ; dir=`basename $$cwd` ; \
	    name=ns-`cat VERSION | tr A-Z a-z` ; \
	    tar=ns-src-`cat VERSION`.tar.gz ; \
	    list="" ; \
	    for i in `cat FILES` ; do list="$$list $$name/$$i" ; done; \
	    echo \
	    "(rm -f $$tar; cd .. ; ln -s $$dir $$name)" ; \
	     (rm -f $$tar; cd .. ; ln -s $$dir $$name) ; \
	    echo \
	    "(cd .. ; tar cfh $$tar [lots of files])" ; \
	     (cd .. ; tar cfh - $$list) | gzip -c > $$tar ; \
	    echo \
	    "rm ../$$name; chmod 444 $$tar" ;  \
	     rm ../$$name; chmod 444 $$tar

force:

